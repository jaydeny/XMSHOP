@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" id="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no" />
    <link href="~/Areas/Phone/Content/Model/reset.css" rel="stylesheet" type="text/css" />
    <link href="~/Areas/Phone/Content/Product/details.css" rel="stylesheet" type="text/css" />
    <script src="~/Areas/Phone/Script/Model/jquery-3.4.0.min.js"></script>
    <script src="~/Areas/Phone/Script/vue.min.js"></script>
</head>
<body>
    <div class="near-box"  id="ProductInfo">
        <div class="gdetails-header">
            <a href="javascript:history.go(-1);" class="gdetails-hleft"></a>
            <div class="gdetails-htbox">
                商品详情
            </div>
            <span class="gdetails-hshare"></span>
        </div>
        <div class="gdetails-bigbox">
            <!--轮播部分-->
            <div id="slideBox" class="slideBox">
                <div class="bd">
                    <ul>
                        <li><a href="javascript:void(0)"><img src="https://img11.360buyimg.com/n7/jfs/t19486/23/2438839474/239517/2fafbf44/5af52742Nfa205639.jpg" /></a></li>
                        <li><a href="javascript:void(0)"><img src="https://img11.360buyimg.com/n7/jfs/t1/15754/23/5665/358122/5c41229aE112fdfdb/aa9e8675d4a214a6.jpg" /></a></li>
                        <li><a href="javascript:void(0)"><img src="https://img13.360buyimg.com/n7/jfs/t1/11352/31/13456/324178/5c98c88dE9419c2ca/4be2efca1d9e2b38.jpg" /></a></li>
                    </ul>
                </div>
                <div class="hd">
                    <ul></ul>
                </div>
            </div>
            <!--轮播部分-->
            <!--商品价格部分-->
            <div class="gdetails-price">
                <div class="gdetails-price-box1">
                    <span class="gdetails-price-text1">￥{{price}}</span>
                    @*<span class="gdetails-price-text2">原价￥14.5</span>
                        <span class="gdetails-price-text3">特价</span>*@
                </div>
                <div class="gdetails-price-box1">
                    <div class="gdetails-price-text5">{{content}}</div>
                </div>
            </div>
            <!--商品价格部分-->
            <!--分享弹层部分-->
            <!--弹层背景部分-->
            <div class="gdetails-layer-bg" style="display: none;"></div>
            <div class="gd-share-layer" style="display: none;">
                <div class="gd-share-layer-box1">分享</div>
                <div class="gd-share-layer-box2">
                    <span class="gd-share-layer-img1"><img src="~/Areas/Phone/img/model/icon_qq.png"></span>
                    <span class="gd-share-layer-text1">QQ</span>
                </div>
                <div class="gd-share-layer-box2">
                    <span class="gd-share-layer-img1"><img src="~/Areas/Phone/img/model/icon_weichat.png"></span>
                    <span class="gd-share-layer-text1">微信</span>
                </div>
                <div class="gd-share-layer-box2">
                    <span class="gd-share-layer-img1"><img src="~/Areas/Phone/img/model/icon_qzone.png"></span>
                    <span class="gd-share-layer-text1">QQ空间</span>
                </div>
                <div class="gd-share-layer-box2">
                    <span class="gd-share-layer-img1"><img src="~/Areas/Phone/img/model/icon_xinlang.png"></span>
                    <span class="gd-share-layer-text1">新浪微博</span>
                </div>
                <div class="gd-share-layer-box2">
                    <span class="gd-share-layer-img1"><img src="~/Areas/Phone/img/model/icon_douban.png"></span>
                    <span class="gd-share-layer-text1">豆瓣网</span>
                </div>
                <div class="gd-share-layer-box2">
                    <span class="gd-share-layer-img1"><img src="~/Areas/Phone/img/model/icon_zhifubao.png"></span>
                    <span class="gd-share-layer-text1">支付宝</span>
                </div>
            </div>
            <!--分享弹层部分-->
            <!--图文详情部分-->
            <div class="recommend-box1">商品详情</div>
            <div class="recommend-box2">
                <span class="recommend-box2-text1"><i>品牌： </i>{{goodsName}}</span>
                <span class="recommend-box2-text1"><i>上架时间： </i>{{chageTime(upTime)}}</span>
            </div>
            <div class="recommend-box1">图文详情</div>
            <div class="image-text-xq-img"><img src="https://img20.360buyimg.com/vc/jfs/t1/31157/27/3434/4087654/5c74ffecEcfe91dbe/bf84b59c6e9ac524.jpg"></div>
            <!--图文详情部分-->
        </div>
        <!--加入购物车部分-->
        <div class="goods-details-bottom">
            <div class="gd-collect">
                <span class="gd-collect-img1"></span>
                <span class="gd-collect-text1">首页</span>
            </div>
            <a href="/Phone/PhoneShoppCart/ShoppingCart_MB" class="gd-collect">
                <span class="gd-collect-img1 img2"><i class="add-num">{{count}}</i></span>
                <span class="gd-collect-text1">购物车</span>
            </a>
            <div class="gd-collect-sx"></div>
            <button class="gd-collect-btn1 addcar" v-on:click="addCart()" >加入购物车</button>
            <button class="gd-collect-btn1 btn2">立即购买</button>
        </div>

    </div>



    <script>
      var cart =  new Vue({
            el: "#ProductInfo",
            data: {
                productID: '',
                product: {},
                price: "",
                content: "",
                goodsName: "",
                upTime: "",
                //获取购物车项的数据
                getCartDataURL: "/Phone/PhoneShoppCart/GetCartByVIPID_MB",
                //编辑购物车
                editCartURL: "/Phone/PhoneShoppCart/EditCart_MB",
                count: 0,
                cartTable: {},
                intCount:1
            },
            created: function () {
                this.init();
                this.showCartCount();
            },
            computed:{
                computCount(){
                    if (this.count > 0) {
                        $(".add-num").show();
                    } else {
                        $(".add-num").hide();
                    }
                }
            },
            methods: {
                //初始化
                init() {
                    const id = this.getParams('id');
                    this.productID = id;
                    console.log(this.productID)
                    $.ajax({
                        url: "/Phone/PhoneProduct/getGoodsInfo",
                        data: { id: id },
                        dataType: 'json'
                    }).then((data) => {

                        this.product = data;
                        this.price = this.product[0].price;
                        this.content = this.product[0].goods_intro;
                        this.goodsName = this.product[0].goods_name;
                        this.upTime = this.product[0].up_time;
                    });
                },
                //URL的截取到商品的编号
                getParams(key) {
                    const reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
                    let r = window.location.search.substr(1).match(reg);
                    if (r != null) {
                        return unescape(r[2]);
                    }
                    return null;
                },
                //时间转换
                chageTime(time) {
                    //console.log(time)
                    if (time) {
                        return time.replace("T", " ").substring(0, 19)
                    } else {
                        return "无法显示"
                    }
                },
                //添加到购物车
                addCart() {
                    let cartData = this.cartTable;
                    
                    
                    $.each(cartData, function (i, v) {
                        //console.log(v.Agoods_ID)
                       // console.log(this.productID)
                        //console.log(cart)
                        if (v.Agoods_ID == cart._data.productID) {
                            console.log("aa");

                            v.Agoods_Count += 1;
                            console.log(v.Agoods_Count);
                            cart._data.intCount = v.Agoods_Count;
                            console.log(cart._data.intCount)
                        }
                        
                    });
                    if (this.intCount === 1) {
                        this.count++;
                    }
                    console.log(this.intCount);
                    this.editCartData(this.intCount);
                    this.showCartCount();
                    this.intCount = 1;
                },
                //购物车前端显示购物车项的数量
                showCartCount() {
                    this.getCartData();
                },
                // 获取后台购物车项的方法
                getCartData() {
                    $.ajax({
                        url: this.getCartDataURL,
                        dataType: 'json'
                    }).then((data) => {
                        this.count = data.data.length;
                        this.cartTable = data.data;
                        if (this.count > 0) {
                            $(".add-num").show();
                        } else {
                            $(".add-num").hide();
                        }
                    });
                },
                editCartData(count) {
                    const param = {
                        editType: 1,
                        AgoodsID: this.productID,
                        count:count
                    }
                    $.ajax({
                        url: this.editCartURL,
                        data: param,
                        dataType: 'json'
                    }).then((data) => {
                        console.log(data)
                    });
                }
            }
        });
    </script>

    <script src="~/Areas/Phone/Script/Product/TouchSlide.1.1.js"></script>

    <script src="~/Areas/Phone/Script/Product/goods-details.js"></script>
</body>
</html>